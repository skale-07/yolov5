<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload and Sort Photos - SnapSort</title>
    <link rel='stylesheet' href='style.css'>
    <script src='script.js'></script>
</head>
<body>
    <!--Sidebar Code-->
    <div class="sidebar">
        <form action="/" method="post" enctype="multipart/form-data">
            <label for="file-input" class="upload-btn">Upload Photos</label>
            <input id="file-input" type="file" name="file[]" multiple style="display: none;" onchange="this.form.submit()">
        </form>

        <form id="delete-form" action="/delete_all" method="POST">
            <input type="submit" value="Delete All Photos" class="delete-btn" id="delete-all-btn">
        </form>

        <form action="sort_by_object" method="post">
            <select id="object-dropdown" name="object">
                <option value="" disabled selected>Loading objects...</option>
            </select>
            <button type="submit" class="sort-btn">Sort by Object</button>
        </form>

        <form action="/sort_by_important_objects" method="post">
            <div class="slider-container">
                <label for="slider">Number of Important Objects:</label>
                <input type="range" id="slider" min="1" max="10" value="5" oninput="updateSliderValue(this.value)">
                <span id="slider-value">5</span>
                <input type="hidden" id="hidden-slider" name="important_objects" value="5">
            </div>
            <button type="submit" class="sort-btn">Sort by Important Objects</button>
        </form>

        <form action="/sort_by_faces" method="post">
            <label>
                <input type="checkbox" id="facial-detection-checkbox" name="facial-detection" value="yes"> Facial Detection
            </label>
            <button type="submit" class="sort-btn">Sort by Faces</button>
        </form>

        <button onclick="downloadSelectedImages()" class="button">Download Selected Images</button>
        <button onclick="clearSelectedImages()" class="button">Delete Selected Images</button>
        <button onclick="logSelectedImages()" class="button">Log Selected Images</button>
    </div>

    <div class="container">
        <div class="uploaded-images">
            <!--Uplodaded images should be displayed here dynamically-->
        </div>

        <!-- Facial Detection Popup -->
        <div id="facialDetectionPopup" class="popup">
            <div class="popup-content">
                <h2>Select Reference Images for Facial Detection</h2>
                <div id="referenceImagesContainer" class="reference-images"></div>
                <div class="popup-buttons">
                    <button onclick="confirmSelection()">Confirm</button>
                    <button onclick="closePopup()">Cancel</button>
                </div>
            </div>
        </div>
    </div>


        <form action="/clear_all" method="POST">
            <input type="submit" value="Clear All Photos" class="delete-btn">
        </form>
        <form method="post" action="/sort">
            <h3>User Input</h3>
            <label><input type="checkbox" name="blurriness" value="on"> Blurriness</label><br>
            <label><input type="checkbox" name="lighting" value="on"> Apply Lighting Filter</label><br>
            <h4 style="margin-top: 5%; margin-bottom: 0;">Orientation</h4>
            <label><input type="checkbox" name="portrait" value="on"> Portrait</label><br>
            <label><input type="checkbox" name="landscape" value="on"> Landscape</label><br>
            <h4 style="margin-top: 5%; margin-bottom: 0;">Objects</h4>
            <div id="object-filters"></div>

            <select id="object-dropdown" name="object-dropdown">
                <option value="" disabled selected>Select an object</option>
            </select>

            <!-- Slider Section Start -->
            <h4 style="margin-top: 5%; margin-bottom: 0;">Number of People</h4>
            <div class="slider-container">
                <div class="checkbox-label-container">
                    <input type="checkbox" name="people-filter" value="on">
                    <label for="people-filter">Number of People</label>
                </div>
                <input type="hidden" id="hidden-slider" name="person-count" value="0">
                <input type="range" id="person-count-slider" class="slider" min="0" max="10" value="0" oninput="updateSliderValue(this.value)">
                <span id="slider-value">0</span>
            </div>

            <h4>Facial Detection</h4>
            <label><input type="checkbox" name="facial-detection" id="facial-detection-checkbox" value="on"> Apply Facial Detection</label>
            <input type="hidden" id="selected-faces" name="selected-faces" value="[]">

            <!-- Slider Section End -->
            <input type="submit" value="Sort" class="sort-btn">
        </form>
    </div>
    <div class="container">
        <h3>Sorted Photos</h3>
        {% if session.get('sorted_images') %}
        <div class="uploaded-images">
            {% for image_path in session['sorted_images'] %}
            <div class="uploaded-image">
                <img src="{{ url_for('static', filename='uploads/' ~ image_path) }}" alt="Sorted Image" style="width: 300px; height: auto;" onclick="toggleSelection(this)">
            </div>
            {% endfor %}
        </div>
        <button onclick="logSelectedImages()" class="button">Test</button>
        <button onclick="clearSelectedImages()" class="button">Clear Selected</button>
        <button onclick="downloadSelectedImages()" class="button">Download Selected</button>
        {% endif %}
    </div>

    <div class="popup" id="facialDetectionPopup">
        <div class="popup-content">
            <h3>Select Reference Faces</h3>
            <div class="reference-images" id="referenceImagesContainer">
                {% for image_path in session['reference_images'] %}
                    <div class="reference-image">
                        <img src="{{ url_for('static', filename='reference_images/' ~ image_path) }}" alt="Sorted Image" style="width: 300px; height: auto;" onclick="toggleSelection(this)">
                    </div>
                {% endfor %}
            </div>
            <div class="popup-buttons">
                <button onclick="closePopup()">Cancel</button>
                <button onclick="confirmSelection()">Confirm</button>
            </div>
        </div>
    </div>
</body>
</html>


